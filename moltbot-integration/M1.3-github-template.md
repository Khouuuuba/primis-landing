# M1.3: GitHub Template Repository

> **Sprint**: M1.3  
> **Status**: ðŸŽ¯ In Progress  
> **Goal**: Create `primisprotocol/moltbot-template` repo for Railway deployments
> **Duration**: 1 day

---

## ðŸ“‹ Sub-Sprint Breakdown

| Sprint | Goal | Duration | Status |
|--------|------|----------|--------|
| M1.3.1 | Create template repo structure | 30 min | ðŸŽ¯ Current |
| M1.3.2 | Optimize Dockerfile for Railway | 30 min | ðŸ”œ Next |
| M1.3.3 | Add railway.toml with health checks | 20 min | ðŸ”œ Planned |
| M1.3.4 | Add startup script & env handling | 30 min | ðŸ”œ Planned |
| M1.3.5 | Create README with instructions | 20 min | ðŸ”œ Planned |
| M1.3.6 | Push to GitHub & test deploy | 30 min | ðŸ”œ Planned |

---

## Why a Template Repo?

Railway needs a source to deploy from. Options:

| Option | Pros | Cons |
|--------|------|------|
| **Docker image** | Fast deploys | Need to host image, versioning |
| **GitHub repo** âœ“ | Railway builds from source | Slower first deploy (~5-10 min) |
| **Railway template** | 1-click deploy | Requires Railway partnership |

**Decision**: GitHub repo with Dockerfile. Railway builds it automatically.

---

## Template Repo Structure

```
primisprotocol/moltbot-template/
â”œâ”€â”€ Dockerfile              # Optimized for Railway builds
â”œâ”€â”€ railway.toml            # Railway configuration
â”œâ”€â”€ docker-compose.yml      # Local testing
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start.sh           # Startup script
â”‚   â””â”€â”€ healthcheck.sh     # Health check script
â”œâ”€â”€ .env.example           # Required environment variables
â””â”€â”€ README.md              # Setup instructions
```

---

## M1.3.1: Create Template Repo Structure

### Files to Create

1. **Dockerfile** - Build Moltbot from source
2. **railway.toml** - Railway deployment config
3. **start.sh** - Entry point with validation
4. **.env.example** - Document required vars
5. **README.md** - Instructions

### Success Metrics

| Metric | Target |
|--------|--------|
| All files created | âœ“ |
| Dockerfile builds locally | âœ“ |
| Structure matches plan | âœ“ |

---

## M1.3.2: Optimize Dockerfile

### Goals
- Multi-stage build (smaller image)
- Cache dependencies efficiently
- Security hardening (non-root user)

### Expected Image Size
- Base node:22 image: ~1GB
- With dependencies: ~1.5-2GB
- Target: < 2GB

---

## M1.3.3: Railway Configuration

### railway.toml Contents

```toml
[build]
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[deploy]
startCommand = "/app/scripts/start.sh"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[[services]]
name = "moltbot"
internalPort = 3000
```

### Health Check Endpoint
- Path: `/health`
- Returns: `{ "status": "ok", "uptime": 1234 }`
- Timeout: 300s (first build is slow)

---

## M1.3.4: Startup Script

### Responsibilities
1. Validate required env vars are set
2. Log startup info (masked secrets)
3. Start Moltbot gateway
4. Handle graceful shutdown

### Required Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `ANTHROPIC_API_KEY` | Conditional | If using Claude |
| `OPENAI_API_KEY` | Conditional | If using GPT |
| `TELEGRAM_BOT_TOKEN` | Optional | Telegram channel |
| `DISCORD_BOT_TOKEN` | Optional | Discord channel |

---

## M1.3.5: README

### Contents
- What this repo is
- How to deploy to Railway
- Environment variables reference
- Troubleshooting guide
- Links to Moltbot docs

---

## M1.3.6: Deploy Test

### Test Plan
1. Push repo to GitHub
2. Connect to Railway
3. Set environment variables
4. Deploy and monitor build
5. Verify health check responds
6. Test Telegram bot (if configured)

### Success Metrics

| Metric | Target |
|--------|--------|
| Build completes | < 10 min |
| Health check passes | âœ“ |
| Bot responds (Telegram) | < 5s |
| Memory usage (idle) | < 1GB |

---

*Last updated: January 31, 2026*
